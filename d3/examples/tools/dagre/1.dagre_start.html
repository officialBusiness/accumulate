<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0">
		<link rel="icon" href="../../logo.svg">
		<title>1.dagre_start</title>
		<link href="../../default_css.css" rel="stylesheet" type="text/css"/>
		<style type="text/css">
			.node{
				cursor: pointer;
			}

			.node > rect {
				stroke-width: 1.5px;
				stroke: #000000;
				fill: #ffffff;
			}

			.node text {
				font-family: Verdana;
			}

			path.link {
				fill: none;
				stroke: #000000;
				stroke-width: 1.5px;
			}
		</style>
	</head>
	<!--

	-->
	<body>
		<script type="text/javascript" src="../../../libs/d3.v7.9.0.js"></script>
		<script type="text/javascript" src="../../../libs/dagre.js"></script>
		<script type="module">
			import createRect from './create_rect.js';
			import createPath, { initPath } from './create_path.js';

			const g = new dagre.graphlib.Graph({compound:true})
				.setGraph({})
				.setDefaultEdgeLabel(function() { return {}; });


			{

				g.setNode("kspacey",    { id: 'kspacey', label: "Kevin Spacey" });
				g.setNode("swilliams",  { id: 'swilliams', label: "Saul Williams" });
				g.setNode("bpitt",      { id: 'bpitt', label: "Brad Pitt" });
				g.setNode("hford",      { id: 'hford', label: "Harrison Ford" });
				g.setNode("lwilson",    { id: 'lwilson', label: "Luke Wilson" });
				g.setNode("kbacon",     { id: 'kbacon', label: "Kevin Bacon" });

				// Add edges to the graph.
				g.setEdge("kspacey",   "swilliams");
				g.setEdge("swilliams", "kbacon");
				g.setEdge("bpitt",     "kbacon");
				g.setEdge("hford",     "lwilson");
				g.setEdge("lwilson",   "kbacon");

			}

			// let id = 0;

			// function addNode(){

			// 	const node = { id: ++id };

			// 	nodes.push({ id: ++id });
			// 	g.setNode( node.id, node );

			// 	dagre.layout(g);
			// }
			// function reduceNode( node ){

			// 	nodes.splice( nodes.indexOf(node), 1 );
			// 	g.removeNode( node.id );

			// 	dagre.layout(g);
			// }

			// addNode();

			initD3();
			function initD3(){

				const container = document.body;

				const svgSelection = d3.select(container)
						.append("svg")
						.attr("width", '100%')
						.attr("height", '100%')

				initPath( svgSelection );


				const gNodes = svgSelection.append('g')
						.attr("class", "nodes")
						.attr("pointer-events", "all");


				update();
				function update(){

					const nodeData = Object.values( g._nodes );

					const node = gNodes.selectAll("g")
						.data( nodeData, (d) => {
							return d.id;
						}).join((enter)=>{
							return createRect(enter);
						})

					dagre.layout(g);

					node.attr("transform", function(d) {
							return "translate(" + d.x + "," + d.y +")";
						});

					node.exit().remove();


					const pathData = Object.values( g._nodes );
				}
			}
		</script>
	</body>
</html>
